<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
        <head>


                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
                <title>Modulmanager</title>
                <%= stylesheet_link_tag 'global' %>
				<%= stylesheet_link_tag 'pool' %>
                <%= stylesheet_link_tag 'jquery.lightbox-0.5' %>





                <script type="text/javascript" src="javascripts/jquery-1.3.2.min.js">
                </script>

                <script type="text/javascript" src="javascripts/jquery-ui-1.7.2.custom.min.js">
                </script>

                <script type="text/javascript" src="javascripts/jquery.lightbox-0.5.js">
                </script>
                <script type="text/javascript">


                        var pool = function(){
						
							var XML = $.ajax({
							
								type: 'GET',
								url: 'http://localhost:3000/abfragen/pool',
								async: false,
								contentType: 'application/x-www-form-urlencoded',
								
								
								error: function(a, b, c){
									alert('Error');
								}
								
								
								
							}).responseXML; //ende AJAX
							
							var root = XML.documentElement;
							
							var poolrekursiv = function(root){
							    var allchildren = $(root).children();
								
								var children = allchildren.length; // anfang 7 Kinder
									if(children ==0) {
										return;
									}
									
									else {
										
										$(root).children().each(function(){   //alle Kinder in einem Konten durchlaufen
										  if ($(this).attr("name")){
											var name = $(this).attr("name");
											$("#pool").append("<div class='poolkategory'>"+name+"</div>");
										  }
										  
										  else if($(this).is("module")){
										  	var name = $(this).find("name").text();
											var id   = $(this).find("id").text();
											$("#pool").append("<div class='poolmodule' id="+id+">"+name+"</div>");
										  	
										  	
										  }
											poolrekursiv(this);
											
										 
											
											
											
										});
										
										
									}
								 
								    
									
								
								
							}//ende poolrekursiv
						
							poolrekursiv(root);
							
							
						}//ende pool











                        $(function(){


                                $('.semester').droppable({
                                        //accept: '.modul',
                                        hoverClass: 'drophover',

                                        drop: function(event, ui){

                                                $(ui.draggable).hide();


                                                $.ajax({
                                                        type: 'GET',

                                                        url : 'http://localhost:3000/abfragen/pool',

                                                        cache:false,
                                                        dataType:'xml',
                                                        async :false,

                                                        contentType:'application/x-www-form-urlencoded',

                                                        success: function(msg){
                                                               rekursiv(msg);
                                                        },
                                                        error: function (a,b,c){
                                                                alert("Erorr");
                                                        }

                                                });//ende Ajax
                                         }//ende Drop
                                  });//ende droppable









                                              /*  $('root',xml).each(function(e){
                                                        //5 module
                                                        size = $(this).children().length;


                                                        //for (i=0; i< size; i++){
                                                                //alle 6 Elemente in einem Modul ausgeben


                                                                $(this).find("category[name='Grundkurse'] module:first-child").each(function(){


                                                                        var name = $(this).find("name").text();

                                                                        var kuerzel =$(this).find("short").text();

                                                                        var credits = $(this).find("credits").text();
                                                                        //$('.semester').remove('li');
                                                                        lineu = '<li class="modul">' + name+kuerzel+credits+'</li>';
                                                                        $('#semester1').append(lineu).fadeOut('fast').fadeIn(400);
                                                                });

                                                        //}//ende for





                                                });  ende each*/















                                        //ende semester sortable

                                        $('.modul').draggable({
                                                cursor: 'crosshair',
                                                revert: 'invalid'


                                        });

                                        /*$('li').draggable({
                                                cursor: 'crosshair',
                                                revert: 'invalid'

                                        });*/

                                        //reingezogene Module draggable
                                        $('li.modul').live("click",function(){
                                                $(this).draggable({
                                                        revert: 'invalid'
                                                });


                                        });


                                        /*$('#modul').sortable({
                                                connectWith: '.semester'
                                        });        */





                        });

                        //////////////////////semesterhinzu/////////////////////////////////////

                        $(function(){

                                $('#semesterhinzu').live("click",function(){
                                        var n = $('#semester-content div').length+1;
                                        var neu = "<br/><div class='semester' id='semester"+n+"'>"+"<h5>"+n+".Semester"+"</h5></div>";


                                        $("#semester-content").append(neu);
										
										
                                        $(".semester").droppable({
                                                hoverClass:'drophover',
                                                drop: function(event,ui){

                                                        $(this).append(ui.draggable);
                                                        $(ui.draggable).hide();
                                                        var xml=$.ajax({
                                                        type: 'GET',
                                                        url :'http://localhost:3000/abfragen/pool',
                                                        dataType:'xml',
                                                        cache:false,
                                                        async :false,
                                                        contentType:'application/x-www-form-urlencoded',
                                                        success: function(msg){

                                                        },
                                                        error: function (a,b,c){
                                                                alert("Erorr");
                                                        }

                                                }).responseXML;


                                                }//ende Drop
                                        });//droppable
                                });//ende live
                        });//ende function









                </script>





        </head>
        <body>


                <div id="container">

                        <div id="header">
                        header

                        </div>
                        <div id="subnavi">

                                <ul id="subnavi-ul">
                                        <li id="return">Zur&uuml;ck</li>
                                        <li id="help">Hilfe</li>
                                        <li id="finish">Fertig</li>
                                        <div class="clear"></div>
                                </ul>

                        </div>

                <!---CONTENT------------------>

                        <div id="content">
                                <div id="left">hallo left</div>

                                <!--middle-->

                                <div id="middle">

                                  <div id="semester-content">
                                        <div class="semester" id="semester1">
                                                <h5>1.Semester</h5>


                                        </div>
                                  </div>
                                <button id="semesterhinzu">Semester hinzuf&uuml;gen</button>

                                </div><!--End middle-->

                                <!--right-->

                                <div id="right">
                                        <div class="clear">
                                        <div id="subright">
                                                M&ouml;gliche Module:<br>
                                                <div id="subright-navi">
                                                        <p id="livesearch">Live suche...</p>
                                                        <div class="clear"></div>
                                                        <ul id="subright-ul">
                                                                <li>Alle</li>
                                                                <li>Theorie</li>

                                                        </ul>
                                                        <div class="clear"></div>
                                                </div><!--End subright-navi -->
										
												
											   <!--hier ist POOL ************************************-->
											   
											    <div id="subright-content">
                                                		<p>POOL:</p>
														<div id="pool">
															
															
														</div>
														
														
												<script>
                                                          pool();
                                                </script>
                                               
                                                        









                                                      




                                        </div><!--subright-->

                                </div><!--right-->



                        </div><!--END content------------------------------------------------------------------------------->

                        <div class="clear"></div>




                </div><!--END container-->
                <div class="clear"></div>
                <br/><br/>
                <div id="footer">
                                footer
                </div>

                <div id="light" class="white_content">
                        Modul information: blabla <a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">Zu</a>
                </div>

               <div id="fade" class="black_overlay"></div>
                </div><!--subright-content-->


        </body>
</html>


